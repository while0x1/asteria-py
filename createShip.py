from pycardano import *
from staticVars import *
from dataclasses import dataclass
from cbor2  import CBORTag
from datetime import datetime
import time 
from blockfrost import ApiUrls


@dataclass()
class Spend(PlutusData):
    # Redeemer to buy the listed values
    CONSTR_ID = 0

@dataclass()
class Mint(PlutusData):
    # Redeemer to buy the listed values
    CONSTR_ID = 0



@dataclass()
class createShip(PlutusData):
    CONSTR_ID = 0
    x: int
    y: int
    shipName: bytes
    pilotName: bytes
    utcTime: int #UTCTime or slot + 300?

@dataclass()
class fuelPellet(PlutusData):
    CONSTR_ID = 0
    x: int
    y: int
    policy: bytes
 

@dataclass()
class authTokenDatum(PlutusData):
    shipCount: int
    policy: bytes
    CONSTR_ID = 0

redeemer = Redeemer(Spend())
auth_script = PlutusV3Script.fromhex('59116c010100333333323232323232323223222322322322322533300d3232323232533233013300130143754004264664464646464a66603460060022a66603a60386ea80280085854ccc068c02000454ccc074c070dd50050010b0a99980d18020008a99980e980e1baa00a0021616301a37540122646464646464646464a666042601460446ea80304c8c8c8c8c8c8c8c94ccc0a4c048c0a8dd50008991919191919191919191929919981a980f00409919299981d181e80109919191919299981e1813181e9baa001132533303d302b303e375400826601600226464646464a66608a60900042646464646464a666090606c60926ea8c134c138c128dd518268030a999824181918249baa00213253330493037304a37540042a666092606460946ea80044c8c8c8c8c8c8c8c8c8c94ccc158c1640084c8c8c8c8c8c8c8c8c8c8c8c8c94ccc18008454ccc18008c54ccc18000c54ccc18000840045280a5014a02940cdd79ba6041374c666605c666605c666062076022900101d807a40040ba9101044655454c0005432533333306600114a02646464a646660cc0042a6660c6600200a266e25200000314a026644a6660ca66ebcc19800930101400015333065337126eb4c19cc1a8dd59833801002898019ba600114a02a6660ca66e2520000051300300714a060d000460d20046ebcc19cc1a000cdd5801992999830982518311baa0011375a60c660cc6eacc198c18cdd50008a400060ca0026466600200203844660cc004660cc6e980052f5c0444a6660ca00426600298103d87a80004bd6f7b630099199911299983319b9148900003153330663371e91010000313300530403306a374c00497ae00011330054c103d87a8000006133300700700122330070023306c337606ea4014dd30020009bae3064001375660ca00260d200660ce00429405280a50374c666605a666060074020900102e245044655454c00053533305d337120a86466e00c004050c00404894ccc178cdc4000a40002605400220022a6660ba0062a6660ba004200229405280a5032533305d304b305e3754002266e24dd69831182f9baa00100b163037305e3754606060bc6ea80f4cdc780599b8a48810550494c4f54003730600407066e3c030cdc52450453484950003730600206e46e64cc008dd4000a450030010012225333233330620031323232323300a0013371491101280053330620021337149101035b5d2900006133714911035b5f2000333300900233714911025d29000062233300a00a00230070012233300a00a002001533305e337100049007099b80483c80400854ccc178cdc40012410004266e00cdc0241002800490068b1bac305f002375a60ba0026466ec0dd4182e8009ba7305e0013754006264a6660be002266e292201027b7d00003133714911037b5f20003232330010010032253330620011003132533306300113233300a00a3062001337149101023a200033300a00a3063001005306500213233300a00a3062001337149101023a200033300a00a30630013007330040040023065002306500133714910102207d000033756006264a6660be002266e29221025b5d00003133714911035b5f2000333300600133714911015d000032233300700700230040012233300700700200137580066e292201022c2000133005375a00400226466e2922010268270032333001001337006e340092001337149101012700003222533305e3371000490000800899191919980300319b8000548004cdc599b80002533306133710004900a0a40c02903719b8b33700002a6660c266e2000520141481805206e0043370c004901019b8300148080cdc70020011bae0022222323300100100522533305f00110051325333060001133004306200200613300530620023300300300130620012232330010010032253330593042001133714910101300000315333059337100029000099b8a489012d0033002002302500113300533708002900a19b8b3370066e1400520144818000cc0040048894ccc158cdc4801240002002266600600666e1000920143371666e00cdc28012402890300008b1bad30570013057002375c60aa00260aa0046eb8c14c004c14c008dd6982880098288011bad304f001304b37540022c2c609a60946ea80085858c130c134008c12c004c12c008dd59824800982480098221baa0011630460013300d0232325333042303030433754002266e3c078dd7182398221baa00114a0603860866ea8c070c10cdd5000a99981f99baf374c00a6e98cccc038dd5980998209baa30133041375402c9110048810003a100114a066e212000333013004375c603260806ea80ecdd7180918201baa03b3375e602e660826ea0cdc000d24004660826ea40652f5c00022c6082607c6ea800458c10000cdd5981f801981f181f800981f000981e981c9baa00116303b0013300201823375e602260706ea8004c044c0e0dd51805181c1baa00d15333035302300813232533303a303d00213232323232533303c3026303d3754002264a66607a6056607c6ea80104c8c8c8c8c94ccc114c1200084c8c8c8c8c94ccc11cc0c4c120dd50008992999824181b18249baa00413232533304a3033304b3754006264646464646464646464a6660ae60b40042646464a6660ae0342a6660ae0322a6660ae0302a6660ae01e2a6660ae01c2a6660ae0062a6660ae004200229405280a5014a029405280a503375e6e980e0dd31999812999814019003a40020a89101044655454c00302233302b0110544881044655454c00325333056304430573754002266e2400cdd6982d982c1baa00116303030573754606060ae6ea80d8cdd79ba7330583750012660b06ea001d2f5c0981049f0000ff0016375a60b000260b00046eb8c158004c158008dd7182a000982a0011bad30520013052002375a60a000260986ea800c58cdd79ba732323300100102b22533304f00114bd70099199911299982819baf00700313305400233006006001133006006001304e001304f001305300230510013374a900119826981218259baa0084bd701ba73304d4c0103d87b80004bd70191929998269828001099299982599b88371a00400229404cdc7999b8c480000040092201045348495000371a910104534849500016375c609c002646600200264a666094607060966ea800452f5bded8c026eacc13cc130dd50009980f8020129129998268008a5eb804cc138c12cc13c004cc008008c14000458c130c124dd50008b18258019bab304a0033049304a0013049001304830443754602c60886ea800458c118004cc0340908c8c8c94ccc110c0c8c114dd50008a999822181918229baa3049304a00213371e6eb8c124c118dd5000810001801982400098221baa301d30443754602c60886ea80085281919baf374c600200c6e98c004dd5980a18211baa30143042375402e4646600200200444a66608a002297adef6c60132333222533304633722910100003153330463371e9101000031001100513304a337606ea400cdd3001198030030009bae30440013756608a0026092004608e00264646464a666084605660866ea80044c8c8c8cdc499b82375a60940026eb4c128c12c008cdc11bad304a002375a60946096002608c6ea8c8c8c080cc128dd419b82375a60960046eb4c12c004cc128dd419b82375a609660980046eb4c12cc1300052f5c0608e6ea8c8c8c8c8c08ccc134dd419b81337046eb4c138010004cdc11bad304e0020033304d375066e0800c0052f5c06eb4c134c138004c124dd5182618249baa006375a60966098002608e6ea8c00d200230463754600400a608a6ea8c00400c8c074cc11cdd400099823a610101004bd700b2999820a5014c0103d87a8000153330414a0260366608a60366608a6ea0c0340e8cc1153001023863004bd7025eb804c06ccc114c06ccc114dd401d19822a61021864004bd7025eb80c008018c004dd5980998209baa30133041375402c46660280029101004881003300b00113375e0380022c6082607c6ea800458c10000cdd5981f801981f181f800981f000981e981c9baa00116303b0013300201823375e602260706ea8004c044c0e0dd51805181c1baa00d15333035301e303637546601c0324a66606c66606ca66606c603e606e6ea8c044c0e0dd51808981c1baa300a303837540022940528a504a2266e21200033300b3756601460706ea8c028c0e0dd50009bae3011303837540666eb8c028c0e0dd50198a5014a22940dc0a400044646600200200644a666074002297ae0133225333039300500213303d00233004004001133004004001303c001303d001225333034301d30353754004264646464a666076607c00400a2c6eb8c0f0004c0f0008dd6981d000981b1baa0021622225333035301e0011004132323300100100622533303b00113303c337606ea4018dd3001a5eb7bdb1804c8ccc8894ccc0f0cdc800500189982019bb037520146e9801c01454ccc0f0cdc7805001899299981e9813181f1baa001133041337606ea402cc108c0fcdd5000801080119299981ea9998200008a5114a02980103d87a80001301733041374c00297ae03233001001003225333041001133042337606ea402cdd400525eb7bdb1804c8ccc8894ccc108cdc800780189982319bb0375201e6ea003801454ccc108cdc78078018992999821981618221baa001133047337606ea4040c120c114dd5000801080119299982198160008a6103d87a80001301d33047375000297ae03370000401c26608c66ec0dd48019ba800233006006001375c60800026eb4c104004c114008c10c0044cc100cdd81ba9003374c0046600c00c0026eb8c0e8004dd5981d800981f801181e800991900118030009981c99bb037520046ea00052f5bded8c0600200244a666068002293099299981a8008a4c264666444a66606c66e4000c0084cc01c01ccc0e801000458dd7181a181c0019bae30340013039002303700130370012225333031301a00114bd6f7b6300991919800800a5eb7bdb180894ccc0dc0044cc0e0cdd81ba9006374c00697adef6c6013233322253330383372001400626607866ec0dd48051ba6007005153330383371e01400626607866ec0dd48051ba600700113303c337606ea400cdd3001198030030009bae30360013756606e00260760046072002646600200297adef6c60225333036001133037337606ea4010dd4001a5eb7bdb1804c8ccc8894ccc0dccdc800400189981d99bb037520106ea001c01454ccc0dccdc780400189981d99bb037520106ea001c0044cc0eccdd81ba900337500046600c00c0026eb8c0d4004dd6981b000981d001181c00098171baa01d23032303300122232533302f301d303037540022900009bad30343031375400264a66605e603a60606ea80045300103d87a8000132330010013756606a60646ea8008894ccc0d0004530103d87a80001323332225333035337220100062a66606a66e3c02000c4c03ccc0e4dd400125eb80530103d87a8000133006006001375c60660026eb4c0d0004c0e0008c0d8004cc01000c00888c8cc00400400c894ccc0c4004530103d87a800013233322253330323372200e0062a66606466e3c01c00c4c030cc0d8dd300125eb80530103d87a8000133006006001375c60600026eacc0c4004c0d4008c0cc004c0b8c0acdd50008b19800806119baf3004302b375400202a44646600200200644a66605c0022980103d87a800013322533302d300500213007330310024bd70099802002000981800098188009ba5480008c0ac004dd7181498150011bad302800130243754002604c60466ea803058dd598129813181300298120021bab3023004375860440086eb0c084010c084c084c084004c080c080004c07cc07c004c068dd50049b8748000dc3a4008603200260326034002602a6ea8008dc3a40042c602c602e006602a00460280046028002601e6ea800452613656375a0026eb4004dd68009bad001375c002ae6955ceaab9e5573eae815d0aba2574898011e581c3babcffc6102ec25ced40e1a24fba20371925c46f0299b2b9456360e004c0127d8799f581cdb0d968cda2cc636b28c0f377e66691a065b8004e57be5129aeef8224461757468ff004c01051a000f4240004c01021832004c01021832004c0101050001')
auth_script_hash = plutus_script_hash(auth_script)

m1 = PlutusV3Script.fromhex('590dfc01010033333332323232323232232232222322322533300c3232323232323232323232323232325323233301d300800c132332232323253330233007001132323232533302a302d00200616375a605600260560046eb4c0a4004c094dd500a0a999811980700089919299981418158010020b1bad3029001302537540282a66604660060022a66604c604a6ea80500085854ccc08ccdc3a400c0022a66604c604a6ea80500085858c08cdd500989919191919191919192999815180718159baa00b1323232323232323232323232325333037301b303837540022646464a666074603c60766ea80044c8c94ccc0f0c09cc0f4dd50008991919191919191919299982298148030991991192999824981a18251baa00113232533304b3036304c3754002264646464646464a6660aa60b000426464646464a6660ae606e60b06ea80044c94ccc160c10cc164dd500209980a000899191919299982e00f8a99982e00f0a99982e0070a99982e0068a99982e0018a99982e00108008a5014a029405280a5014a066ebcdd301a1ba632533305c304000114bd6f7b6300991919800800a5eb7bdb180894ccc1880044cc18ccdd81ba905d374c00697adef6c601323332225333063337200c20062660ce66ec0dd48309ba6007005153330633371e0c20062660ce66ec0dd48309ba6007001133067337606ea400cdd3001198030030009bae3061001375660c400260cc00460c8002646600200297adef6c6022533306100113306233760980105444655454c00375000697adef6c601323332225333062337209101044655454c0000313306633760980105444655454c00375000e00a2a6660c466e3d221044655454c0000313306633760980105444655454c00375000e0022660cc66ec0dd48019ba800233006006001375c60c00026eb4c184004c194008c18c004c09c038cdd79ba6301a005374c6034666602e6eacc104c170dd51820982e1baa020058489044655454c00302600d53330593375e608c660ba6ea0cdc00150099982e9ba833700052024660ba6ea40a0cc174dd48139982e9800982d9baa0024bd70001099b8900e375a600260b66ea80085281182f182f982f982f982f8008b182e182c9baa00116305b003375660b400660b260b400260b200260b060a86ea800458c158004cc0e40a88cdd7981b98299baa001303730533754607060a66ea805ccdc480e003192999827981998281baa001132323371266e08dd6982b0011bad30563057001337046eb4c158004dd6982b182b80118291baa0193051375460a860a26ea800458cc064008cdc080180299b820010433233700600200e600200c4a66609a66e200052000130190011001375a60a0609a6ea800458c0c0c130dd5181898261baa022375a609c60966ea800458c0b8c128dd5181718251baa020375a60960026eb4c12cc130004c11cdd501b0a9998229818003099191929998259827001099191919192999826981698271baa001132533304e3039304f37540082660140022646464a6660a20282a6660a20262a6660a20062a6660a2004200229405280a5014a064a6660a2606c018266e2400412452819981d002827245044655454c003375e6e98c03c010dd3180799998061bab303630513754606c60a26ea80541352201044655454c0000a3375e0020482c60a4609e6ea800458c14400cdd59828001982798280009827800982718251baa00116304c0013302f02023375e605a60926ea8004c0b4c124dd5181718249baa00d375a6094608e6ea80d854ccc114c0940184c8c94ccc128c1340084c8c94ccc12403054ccc12402c54ccc12400840045280a5014a066ebcdd39981b00f99ba548008cc130c0b8c128dd500125eb80dd39982626103d87a80004bd7018161998189bab302e30493754605c60926ea8004dd7181698249baa042375c605c60926ea810858c12c004cc0b80808c94ccc11cc0acc120dd50008a5013371e6eb8c130c124dd5000821981618241baa302c30483754605a60906ea80044c8c94ccc11c02854ccc11c02454ccc11c00840045280a5014a066e1cccc0c007c111221044655454c0030123330303756605a60906ea8c0b4c120dd5006022245044655454c003371066605e03c0120289000112999823181518239baa0021323232323232323232325333053305600200b16375a60a800260a80046eb8c148004c148008dd7182800098280011bad304e001304e002375a609800260906ea80085888894ccc11cc0ac00440104c8c8cc004004018894ccc1340044cc138cdd81ba9006374c00697adef6c60132333222533304e337200140062660a466ec0dd48051ba60070051533304e3371e014006264a66609e606660a06ea80044cc14ccdd81ba900b305430513754002004200464a66609ea6660a400229445280a6103d87a80001303c33053374c00297ae03233001001003225333053001133054337606ea402cdd400525eb7bdb1804c8ccc8894ccc150cdc800780189982c19bb0375201e6ea003801454ccc150cdc7807801899299982a981c982b1baa001133059337606ea4040c168c15cdd5000801080119299982a981c8008a6103d87a80001304233059375000297ae03370000401c2660b066ec0dd48019ba800233006006001375c60a40026eb4c14c004c15c008c1540044cc148cdd81ba9003374c0046600c00c0026eb8c130004dd5982680098288011827800991900118030009982599bb037520046ea00052f5bded8c0600200244a66608c00229309929998238008a4c264666444a66609066e4000c0084cc01c01ccc13001000458dd7182318250019bae3046001304b002304900130490012323300100100222533304600114bd6f7b630099199911299982399b91488100003153330473371e9101000031001100513304b337606ea400cdd3001198030030009bae30450013756608c0026094004609000260806ea80c0c0a4cc8c004004894ccc10c0045200013370090011980100118230009981380c9192999820181218209baa00114a0266e3cdd7182298211baa001004302530413754604a60826ea8c098c104dd5000a99981e9810981f1baa33005018232330010013233001001330283756604e60846ea8c09cc108dd50018021129998220008a5eb804cc114c108c118004cc008008c11c004894ccc10c00452809991299982119b8f00201014a22660080080026eb8c114004c1180045288a50375c6082607c6ea800458c084c0f4dd51810981e9baa3022303d3754002607e60786ea800458cc0040508cdd79810181e1baa00101c22323300100100322533303f00114c0103d87a800013322533303e30050021302b330420024bd7009980200200098208009821000981e181c9baa0011633001375a603860706ea80c0dd6980e981c1baa030225333037301b00114c103d87a800015333037337100029000098121981d98121981d9ba830030023303b3750600600297ae04bd70098121981d98121981d9ba80023303b375000297ae04bd701b8148000dd6981c181c8029bae3037004375c606c0086eb4c0d4010dd6981a002181a0009819800981900098169baa001302f302c37540162c6eacc0b8c0bcc0bc014c0b4010dd598160021bac302b00437586054008605460546054002605260520026050605000260466ea804cdc3a4008604600260466048002603e6ea803454ccc074c0040304c8c8c94ccc080c01000454ccc08cc088dd50088010b0a99981018058008a99981198111baa01100216163020375402026464646464a666046600e60486ea80504c8c94ccc0a0c0ac0084c94ccc098c02cccc040dd5980698141baa300d302837540046eb8c030c0a0dd50109bae300d3028375404220022940cdd79ba7330130043374a900119814980598139baa0014bd701ba7330294c103d87980004bd700b1814800998060019192999812980498131baa00114a0266e3cdd7181518139baa001021300a302637546014604c6ea8c02cc098dd500089919299981418158010a99981299b8748004dd698138008a51161630290013300b0010063756604e0066eacc098c09cc09cc09cc09cc09c008dd61812801181298129812981280098101baa010375c6044603e6ea803458dc3a40006e212000230200012301f30200012232533301b3006301c3754002297adef6c60137566040603a6ea8004cc01800800488c8cc00400400c894ccc07800452f5c026644a66603a600a004266042004660080080022660080080026040002604200244464a666034600a60366ea8004520001375a603e60386ea8004c94ccc068c014c06cdd50008a60103d87a80001323300100137566040603a6ea8008894ccc07c004530103d87a80001323332225333020337220100062a66604066e3c02000c4c034cc090dd400125eb80530103d87a8000133006006001375c603c0026eb4c07c004c08c008c084004cc01400c008dc3a400444646600200200644a666036002298103d87a8000132333222533301c3372200e0062a66603866e3c01c00c4c024cc080dd300125eb80530103d87a8000133006006001375c60340026eacc06c004c07c008c074004dd2a400044646600200200644a666032002297ae0132333222533301a3375e00e00626603c0046600c00c00226600c00c00260300026032002603a004603600260246ea8004c054c05800cc050008c04c008c04c004c038dd50008a4c26cac6eb4004dd68009bae001375c002ae6955ceaab9e5573eae815d0aba24c011e581c3babcffc6102ec25ced40e1a24fba20371925c46f0299b2b9456360e004c011e581cd55e332cd46d2abfe24dfa0558c2dedd0114d00424352eb807aac137004c0127d8799f581cdb0d968cda2cc636b28c0f377e66691a065b8004e57be5129aeef8224461757468ff004c010ad8799f011a00b89200ff004c010105004c0101010001')

OGMIOS_IP = '127.0.0.1'
print('Select your asteria starting X-Coordinate:')
start_x_in = input()
START_X = int(start_x_in)
print('Select your asteria starting Y-Coordinate:')
start_y_in = input()
START_Y = int(start_y_in)

hdwallet = HDWallet.from_mnemonic(SEED)
hdwallet_stake = hdwallet.derive_from_path("m/1852'/1815'/0'/2/0")
stake_public_key = hdwallet_stake.public_key
stake_vk = PaymentVerificationKey.from_primitive(stake_public_key)
hdwallet_spend = hdwallet.derive_from_path("m/1852'/1815'/0'/0/0")
spend_public_key = hdwallet_spend.public_key
payment_vkey = PaymentVerificationKey.from_primitive(spend_public_key)
payment_skey = ExtendedSigningKey.from_hdwallet(hdwallet_spend)
stake_skey = StakeExtendedSigningKey.from_hdwallet(hdwallet)
stake_vkey = PaymentVerificationKey.from_primitive(stake_public_key)

#payment_skey = PaymentSigningKey.from_primitive(bytes.fromhex(skey))
#payment_vkey = PaymentVerificationKey.from_signing_key(payment_skey)

userAddress = Address(payment_vkey.hash(),stake_vkey.hash(),network=Network.MAINNET)
#userAddress = Address(payment_vkey.hash(),network=Network.MAINNET)
if BLOCK_FROST_PROJECT_ID != None:
    print('Using Blockfrost for chain Context')
    chain_context = BlockFrostChainContext(project_id=BLOCK_FROST_PROJECT_ID,base_url=ApiUrls.mainnet.value,)
else:
    print('No Blockfrost key found using ogmios for chain context')
    chain_context = OgmiosV6ChainContext(OGMIOS_IP,network=Network.MAINNET)

builder = TransactionBuilder(chain_context)
builder.add_input_address(userAddress)
#builder.use_redeemer_map = False

ref_utxos_address = 'addr1w9mhn8s0qleh03mxwmlfyv4ekz790j5jc4sn9qturwsx6zcuxlz27'
ref_utxos = chain_context.utxos(ref_utxos_address)

mintRedeemer1 = Redeemer(Mint())
mintRedeemer2 = Redeemer(Mint())
mintRedeemer3 = Redeemer(Mint())

pilot_policy = '0291ae7aebaf064b785542093c2b13169effb34462301e68d4b44f43'
#pilot_name = b'SLARTIBARTFAST'
#ship_name = b'BISTROMATH'

fuel_policy = '3babcffc6102ec25ced40e1a24fba20371925c46f0299b2b9456360e'
#ship and fuel sent to addr1wypfrtn6awhsvjmc24pqj0ptzvtfalang33rq8ng6j6y7scnlkytx
auth_utxos = chain_context.utxos('addr1w824uvev63kj40lzfhaq2kxzmmwsz9xsqsjr2t4cq74vzdcdw8c77')
auth_datum = auth_utxos[0].output.datum
raw_datum = RawPlutusData.from_cbor(auth_datum.cbor)
ship_count = raw_datum.data.value[0]

pilot_name = f"PILOT{ship_count}".encode('utf-8')
ship_name = f"SHIP{ship_count}".encode('utf-8')

SHIP_FUEL_PILOT_MINT = MultiAsset.from_primitive({bytes.fromhex(pilot_policy): {ship_name: 1,pilot_name:1},bytes.fromhex(fuel_policy): {b'FUEL': 5 }})

FUEL_MA = MultiAsset.from_primitive({bytes.fromhex(fuel_policy): {b'FUEL': 5 }})#3bab
SHIP_MA = MultiAsset.from_primitive({bytes.fromhex(pilot_policy): {ship_name: 1 }})
SHIP_FUEL_MA = MultiAsset.from_primitive({bytes.fromhex(pilot_policy): {ship_name: 1},bytes.fromhex(fuel_policy): {b'FUEL': 5 }})
SHIP_PILOT_MA = MultiAsset.from_primitive({bytes.fromhex(pilot_policy): {ship_name: 1,pilot_name:1}})
PILOT_MA = MultiAsset.from_primitive({bytes.fromhex(pilot_policy): {pilot_name: 1 }})

#builder.add_minting_script(m1,mintRedeemer1)#0291
builder.add_minting_script(ref_utxos[1],mintRedeemer2)#0291
builder.add_minting_script(ref_utxos[2],mintRedeemer3)#3bab
builder.mint = SHIP_FUEL_PILOT_MINT
builder.add_script_input(auth_utxos[0],script=ref_utxos[0],redeemer=redeemer)

auth_policy = 'db0d968cda2cc636b28c0f377e66691a065b8004e57be5129aeef822'
auth_token = MultiAsset.from_primitive({bytes.fromhex(auth_policy): {b'auth': 1 }})
FUEL_MA = MultiAsset.from_primitive({bytes.fromhex(fuel_policy): {b'FUEL': 5 }})#3bab

#signature = payment_skey.sign(unsignedTx.transaction_body.hash())
#vk_witnesses = [VerificationKeyWitness(payment_vkey, signature)]
#signed_tx = Transaction(unsignedTx.transaction_body, TransactionWitnessSet(vkey_witnesses=vk_witnesses))
validitySlot = chain_context.last_block_slot+300
UTC_now = int((time.time() + 350 ) * 1000)
createShipDatum = createShip(START_X,START_Y,ship_name,pilot_name,UTC_now)
authDatumNew = authTokenDatum(ship_count + 1, bytes.fromhex(pilot_policy))

ship_holding_address = Address.from_primitive('addr1wypfrtn6awhsvjmc24pqj0ptzvtfalang33rq8ng6j6y7scnlkytx')
auth_address = Address.from_primitive('addr1w824uvev63kj40lzfhaq2kxzmmwsz9xsqsjr2t4cq74vzdcdw8c77')
builder.add_output(TransactionOutput(ship_holding_address,Value(1500000,SHIP_FUEL_MA), datum=createShipDatum))
builder.add_output(TransactionOutput(auth_address,Value(auth_utxos[0].output.amount.coin + 1000000, auth_token), datum=authDatumNew))
builder.add_output(TransactionOutput(userAddress,Value(1500000,PILOT_MA)))

#builder.ttl= validitySlot
signed_tx = builder.build_and_sign([payment_skey], userAddress,auto_validity_start_offset=0,auto_ttl_offset=300)
#ytx
#gets shipNft Fuel Nfts and 
chain_context.submit_tx(signed_tx.to_cbor())
